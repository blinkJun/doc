# `css`常见问题和解决方法

- `flex:1`元素无效，被子元素内容撑开。在此元素上加上`width:0`

- `inline-block`元素之间存在间隙，在父级使用`font-size:0px`消除

- `line-height` 1.5 与 150%的区别

  - 父元素设置 1.5，子元素行高为**子元素** `fontsize*1.5`
  - 父元素设置 150%，子元素行高为**父元素** `fontsize*150%`

- `opacity: 0`、`visibility: hidden`、`display: none`这三者的区别:

1.  结构上:

    - `display: none` 会让元素完全从渲染树中消失, 渲染的时候不占据任何空间, 不能点击.

    - `visibility: hidden` 不会让元素从渲染树消失, 渲染元素继续占据空间, 只是内容不可见, 不能点击.

    - `opacity: 0` 不会让元素从渲染树消失, 渲染元素继续占据空间, 只是内容不可见, 可以点击.

2.  继承性:

    - `display: none` 和 `opacity: 0` 是非继承属性, 子孙节点消失由于元素从渲染树消失造成, 通过修改子孙节点属性无法显示.

    - `visibility: hidden` 是继承属性, 子孙节点消失是由于继承了 `visibility: hidden`, 通过设置`visibility: visible` 可以让子孙节点显式.

3.  性能:

    - `display: none` 修改元素会造成文档回流, 读屏器不会读取元素内容, 性能消耗较大.

    - `visibility: hidden` 修改元素只会造成本元素的重绘, 读屏器会读取元素内容, 性能消耗较少.

    - `opacity: 0` 修改元素会造成重绘, 性能消耗较少.

- 为什么要用预处理器

  1. 嵌套，`css`代码更清晰
  2. 变量，统一样式
  3. `mixin`，复用`css`样式

- 如何实现垂直居中布局

  - 需要知道高度
    1. 绝对定位+负外边距
    2. 绝对定位+自动外边距
    3. 绝对定位+计算属性
  - 不需要知道高度
    1. 绝对定位+`tranform：translate`
    2. `flex`布局
    3. 行高，子元素必须是`inline`或者`inline-block`
    4. `vertical-align`
       - 此属性的元素的位置不是针对外框而是同级元素的高度来定位的
       - 可在父级添加一个高度为 100%的子元素提供参考
    5. `display:table-cell`

- 如何清除浮动导致的高度塌陷

  - 通过在浮动元素的尾部增加一个元素并添加`clear`属性
  - 创建父级 `BFC`
  - 设置高度

- 如何适配 iphoneX 等机型的底部导航条

  1. `viewport`需要设置：`viewport-fit=cover`

  2. 在固定定位中设置向下内边距：

  ```css
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
  ```

- `Chrome` 中文界面下默认会将小于 12px 的文本强制按照 12px 显示,可通过加入 CSS 属性 `-webkit-text-size-adjust: none`; 解决。

- `ios`弹性滚动：在苹果系统上非`<body>`元素的滚动操作可能会存在卡顿，但安卓系统不会出现该情况。通过声明`overflow-scrolling:touch`调用系统原生滚动事件优化弹性滚动，增加页面滚动的流畅度。

  ```css
  body {
    -webkit-overflow-scrolling: touch;
  }
  .elem {
    overflow: auto;
  }
  ```

- 禁止长按操作

  ```css
  * {
    /* pointer-events: none; */ /* 微信浏览器还需附加该属性才有效 */
    user-select: none; /* 禁止长按选择文字 */
    -webkit-touch-callout: none;
  }
  input,
  textarea {
    user-select: auto;
  }
  ```

- 禁止触摸元素时元素高亮

  ```css
  * {
    -webkit-tap-highlight-color: transparent;
  }
  ```

- 非点击元素点击失效：

  ```css
  .elem {
    cursor: pointer;
  }
  ```

- 禁止点击穿透和`300ms`延迟

  ```js
  import Fastclick from 'fastclick';
  FastClick.attach(document.body);
  ```

- 禁止滑动穿透

  ```css
  body.static {
    position: fixed;
    left: 0;
    width: 100%;
  }
  ```

  ```js
  const body = document.body;
  const openBtn = document.getElementById('open-btn');
  const closeBtn = document.getElementById('close-btn');
  openBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const scrollTop = document.scrollingElement.scrollTop;
    body.classList.add('static');
    body.style.top = `-${scrollTop}px`;
  });
  closeBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    body.classList.remove('static');
    body.style.top = '';
  });
  ```

- 修复高度塌陷：输入框失焦后页面未回弹。

  - 页面高度过小
  - 输入框在页面底部或视窗中下方
  - 输入框聚焦输入文本

  ```js
  const input = document.getElementById('input');
  let scrollTop = 0;
  input.addEventListener('focus', () => {
    scrollTop = document.scrollingElement.scrollTop;
  });
  input.addEventListener('blur', () => {
    document.scrollingElement.scrollTo(0, scrollTop);
  });
  ```

## 实现

- 自动计算`rem`基准值

  ```css
  html {
    font-size: calc(100vw / 7.5);
  }
  ```

- 美化滚动条

  ```css
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
    background-color: transparent;
  }
  ::-webkit-scrollbar-track {
    background-color: transparent;
  }
  ::-webkit-scrollbar-thumb {
    border-radius: 3px;
    background-image: linear-gradient(135deg, #09f, #3c9);
  }
  ```

- 美化`input`占位符样式

  ```css
  input::-webkit-input-placeholder {
    color: #66f;
  }
  ```

- 空载布局：无子元素内容时显示占位元素

  ```html
  <ul class="empty-layout">
    <li>1</li>
    <li>2</li>
    <li>3</li>
    <li>4</li>
    <li>5</li>
    <li>6</li>
    <li>7</li>
    <li>8</li>
    <li>9</li>
  </ul>
  <ul class="empty-layout"></ul>
  ```

  ```scss
  $empty: 'https://yangzw.vip/img/empty.svg';
  .empty-layout {
    overflow: auto;
    width: 200px;
    height: 150px;
    outline: 1px solid #3c9;
    &:empty {
      display: flex;
      justify-content: center;
      align-items: center;
      background: url($empty) no-repeat center/100px auto;
      &::after {
        margin-top: 90px;
        font-weight: bold;
        content: '没钱就没数据';
      }
    }
    li {
      padding: 0 10px;
      height: 30px;
      background-color: #09f;
      line-height: 30px;
      color: #fff;
      &:nth-child(even) {
        background-color: #f90;
      }
    }
  }
  ```

- 多格布局
  ```html
  <ul class="multigrid-layout">
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
    <li class="item">
      <img src="https://static.yangzw.vip/codepen/ab-3.jpg" />
    </li>
  </ul>
  ```
  ```scss
  @mixin square($count: 2) {
    $length: calc((100% - #{$count} * 10px) / #{$count});
    width: $length;
    height: $length;
  }
  .multigrid-layout {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    align-content: flex-start;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
    width: 400px;
    height: 400px;
    li {
      display: flex;
      overflow: hidden;
      justify-content: center;
      margin: 5px;
      background-color: #f0f0f0;
      @include square(3);
    }
    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }
  // 一个元素
  .item:only-child {
    border-radius: 10px;
    width: auto;
    max-width: 80%;
    height: auto;
    max-height: 80%;
  }
  ```
